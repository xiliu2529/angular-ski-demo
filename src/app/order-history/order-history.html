<!-- é¡µé¢æ ‡é¢˜ -->
<header class="order-history-header">
  <h1>è®¢å•å†å²</h1>
  <p>æŸ¥çœ‹æ‚¨çš„æ»‘é›ªç¥¨è´­ä¹°è®°å½•</p>
</header>

<!-- ç»Ÿè®¡ä¿¡æ¯ -->
<section class="stats-section">
  <div class="stats-cards">
    <div class="stat-card">
      <div class="stat-number">{{ getTotalOrders() }}</div>
      <div class="stat-label">æ€»è®¢å•æ•°</div>
    </div>
    <div class="stat-card">
      <div class="stat-number">{{ formatPrice(getTotalSpent()) }}</div>
      <div class="stat-label">æ€»æ¶ˆè´¹é‡‘é¢</div>
    </div>
    <div class="stat-card">
      <div class="stat-number">{{ formatPrice(getTotalSavings()) }}</div>
      <div class="stat-label">æ€»èŠ‚çœé‡‘é¢</div>
    </div>
  </div>
</section>

<!-- è®¢å•åˆ—è¡¨ -->
<main class="orders-container">
  @if (orders.length === 0) {
    <div class="empty-state">
      <div class="empty-icon">ğŸ“‹</div>
      <h3>æš‚æ— è®¢å•è®°å½•</h3>
      <p>æ‚¨è¿˜æ²¡æœ‰è´­ä¹°ä»»ä½•æ»‘é›ªç¥¨åˆ¸</p>
      <button class="go-shopping-btn" (click)="navigateToPricing()">å»è´­ä¹°</button>
    </div>
  } @else {
    <div class="orders-list">
      @for (order of orders; track order.id) {
        <div class="order-card">
          <div class="order-header" (click)="toggleOrder(order.id)">
            <div class="order-info">
              <div class="order-id">è®¢å•å·ï¼š{{ order.id }}</div>
              <div class="order-date">{{ formatDate(order.orderDate) }}</div>
            </div>
            <div class="order-summary">
              <div class="order-amount">{{ formatPrice(order.totalAmount) }}</div>
              <div class="order-status">
                <span class="status-badge {{ getStatusClass(order.status) }}">
                  {{ getStatusText(order.status) }}
                </span>
              </div>
              <div class="expand-icon">
                {{ isOrderExpanded(order.id) ? 'â–¼' : 'â–¶' }}
              </div>
            </div>
          </div>

          @if (isOrderExpanded(order.id)) {
            <div class="order-details">
              <div class="order-items">
                @for (item of order.items; track item.id) {
                  <div class="order-item">
                    <div class="item-info">
                      <h4>{{ item.resortName }} - {{ item.ticketType }}</h4>
                      <p class="item-duration">{{ item.duration }}</p>
                      <div class="item-features">
                        @for (feature of item.features; track $index) {
                          <span class="feature-tag">{{ feature }}</span>
                        }
                      </div>
                    </div>
                    <div class="item-pricing">
                      <div class="item-quantity">æ•°é‡ï¼š{{ item.quantity }}</div>
                      <div class="item-total">{{ formatPrice(item.price * item.quantity) }}</div>
                    </div>
                  </div>
                }
              </div>

              <div class="order-summary-details">
                <div class="summary-row">
                  <span>åŸä»·æ€»è®¡ï¼š</span>
                  <span class="original-price">{{ formatPrice(order.totalOriginalAmount) }}</span>
                </div>
                <div class="summary-row savings">
                  <span>èŠ‚çœé‡‘é¢ï¼š</span>
                  <span class="savings-amount">-{{ formatPrice(order.totalSavings) }}</span>
                </div>
                <div class="summary-row total">
                  <span>å®ä»˜é‡‘é¢ï¼š</span>
                  <span class="total-amount">{{ formatPrice(order.totalAmount) }}</span>
                </div>
              </div>

              <div class="order-actions">
                <button class="delete-btn" (click)="deleteOrder(order.id)">åˆ é™¤è®¢å•</button>
              </div>
            </div>
          }
        </div>
      }
    </div>
  }
</main>
